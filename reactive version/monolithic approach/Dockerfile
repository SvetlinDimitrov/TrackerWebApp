# Stage 1: Build the application
FROM maven:3.8.4-openjdk-17-slim AS build
WORKDIR /app
COPY . .
RUN mvn clean package -DskipTests

# Stage 2: Create the final image
FROM openjdk:17-jdk-slim
WORKDIR /app
COPY --from=build /app/target/NutriGuideBuddy-0.0.1-SNAPSHOT.jar app.jar
EXPOSE 8080
ENV SPRING_PROFILES_ACTIVE=prod
# Set environment variables
ARG DB_USERNAME
ARG DB_PASSWORD
ARG DB_HOST
ARG ORIGINS
ARG FRONT_END_URL
ARG SENDINBLUE_API_KEY
ARG EMAIL_SENDER
ARG FOOD_DATA_API_KEY
ARG FOOD_DATA_API_ID
ARG FOOD_DATA_API_URL
ARG JWT_SECRET
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD
ENV DB_HOST=$DB_HOST
ENV ORIGINS=$ORIGINS
ENV FRONT_END_URL=$FRONT_END_URL
ENV SENDINBLUE_API_KEY=$SENDINBLUE_API_KEY
ENV EMAIL_SENDER=$EMAIL_SENDER
ENV FOOD_DATA_API_KEY=$FOOD_DATA_API_KEY
ENV FOOD_DATA_API_ID=$FOOD_DATA_API_ID
ENV FOOD_DATA_API_URL=$FOOD_DATA_API_URL
ENV JWT_SECRET=$JWT_SECRET
ENTRYPOINT ["java", "-jar", "app.jar"]